#! /bin/bash
#
# Compress and encrypt the Ivido folder and store it in the TransIP VPS.
# Encrpts with GPG key of Jari Maijenburg <jari.maijenburg@formelio.nl>

set -e

filename="${1:-$(hostname)}"

notify-send -u low 'Ivido folder backup started' 'Backing up ~/Ivido to vps.ivido.nl...'

if tar czf - --strip-components=2 $HOME/Ivido | gpg --encrypt -r jari.maijenburg@formelio.nl | ssh jari@vps.ivido.nl "cat > ~/laptop_backups/$filename.tar.gz.gpg"; then
    notify-send -u normal 'Ivido folder backup succeeded!' 'Successfully uploaded backup of ~/Ivido to vps.ivido.nl'
else
    notify-send -u critical 'Ivido folder backup failed' 'Failed uploading ~/Ivido backup to vps.ivido.nl'
fi
